# üìã –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–∞ "–ò–≥—Ä–∞—Ç—å –µ—â–µ —Ä–∞–∑" (–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥)

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ò–ì–†–ê–¢–¨ –ï–©–ï –†–ê–ó" –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ "http not found" (404).

---

## üìÅ –§–∞–π–ª—ã, –æ—Ç–≤–µ—á–∞—é—â–∏–µ –∑–∞ –ø—Ä–æ—Ü–µ—Å—Å:

### 1. **–ö–õ–ò–ï–ù–¢–°–ö–ê–Ø –ß–ê–°–¢–¨ (Frontend)**

#### `client/public/game-table-test.html`
**–°—Ç—Ä–æ–∫–∏:** 2830-2875
- **–§—É–Ω–∫—Ü–∏—è `voteNewRound()`** (—Å—Ç—Ä–æ–∫–∞ 2830)
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç `fetch` –∑–∞–ø—Ä–æ—Å –∫ `/api/vote-new-round`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `getServerUrl()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL —Å–µ—Ä–≤–µ—Ä–∞
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `{ roomId, playerId }`

- **–§—É–Ω–∫—Ü–∏—è `startWithVoted()`** (—Å—Ç—Ä–æ–∫–∞ 2857)
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç `fetch` –∑–∞–ø—Ä–æ—Å –∫ `/api/start-with-voted`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `getServerUrl()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL —Å–µ—Ä–≤–µ—Ä–∞
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `{ roomId, playerId }`

- **–§—É–Ω–∫—Ü–∏—è `getServerUrl()`** (—Å—Ç—Ä–æ–∫–∞ 2047)
  - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç URL —Å–µ—Ä–≤–µ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç hostname
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `http://localhost:3006` –∏–ª–∏ `http://${hostname}:3006`

- **–§—É–Ω–∫—Ü–∏—è `updateVoteNewRoundSection()`** (—Å—Ç—Ä–æ–∫–∞ 2743)
  - –û–±–Ω–æ–≤–ª—è–µ—Ç UI –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç/—Å–∫—Ä—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è

**HTML —ç–ª–µ–º–µ–Ω—Ç—ã:**
- `<div id="voteNewRoundSection">` - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è (—Å—Ç—Ä–æ–∫–∞ 1883)
- `<button id="voteNewRoundBtn">` - –∫–Ω–æ–ø–∫–∞ "–ò–ì–†–ê–¢–¨ –ï–©–ï –†–ê–ó" (—Å—Ç—Ä–æ–∫–∞ 1892)
- `<button id="startWithVotedBtn">` - –∫–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –≤—Ç—Ä–æ–µ–º" (—Å—Ç—Ä–æ–∫–∞ 1895)

---

### 2. **–°–ï–†–í–ï–†–ù–ê–Ø –ß–ê–°–¢–¨ (Backend)**

#### `server/server.js`
**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API:**

1. **`POST /api/vote-new-round`** (—Å—Ç—Ä–æ–∫–∞ 454)
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: `{ roomId, playerId }`
   - –í—ã–∑—ã–≤–∞–µ—Ç: `game.voteNewRound(playerId)`
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Pusher: `room-${roomId}`, `game-update`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ success: true, ...result }`

2. **`POST /api/start-with-voted`** (—Å—Ç—Ä–æ–∫–∞ 494)
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: `{ roomId, playerId }`
   - –í—ã–∑—ã–≤–∞–µ—Ç: `game.startWithVotedPlayers()` –∏–ª–∏ `game.voteNewRound(playerId)` —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Pusher
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ success: true }`

---

#### `server/gameLogic.js`
**–ö–ª–∞—Å—Å `SekaGame`:**

1. **`voteNewRound(playerId)`** (—Å—Ç—Ä–æ–∫–∞ 1597)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `gameState === 'voting_new_round'`
   - –î–æ–±–∞–≤–ª—è–µ—Ç/—É–±–∏—Ä–∞–µ—Ç –∏–≥—Ä–æ–∫–∞ –∏–∑ `voteNewRoundPlayers`
   - –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `startNewRound()`
   - –ï—Å–ª–∏ 3 –∏–∑ 4 ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä –Ω–∞ 10 —Å–µ–∫—É–Ω–¥
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ allVoted, votedCount, totalPlayers, readyToStartWithVoted }`

2. **`startWithVotedPlayers()`** (—Å—Ç—Ä–æ–∫–∞ 1688)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `gameState === 'voting_new_round'`
   - –î–µ–ª–∞–µ—Ç —Å–ø—è—â–∏–º–∏ —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª (–µ—Å–ª–∏ 3 –∏–∑ 4)
   - –í—ã–∑—ã–≤–∞–µ—Ç `startNewRound()`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ success: true }`

3. **`startNewRound()`** (—Å—Ç—Ä–æ–∫–∞ 1520)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `canContinueGame()` - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
   - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ (`resetPlayerStates()`)
   - –°–æ–±–∏—Ä–∞–µ—Ç –∞–Ω—Ç–µ (`collectAnte()`)
   - –†–∞–∑–¥–∞–µ—Ç –∫–∞—Ä—Ç—ã (`dealCards()`)
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `gameState = 'betting'`
   - –ù–∞—Ö–æ–¥–∏—Ç –ø–µ—Ä–≤–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä —Ö–æ–¥–∞ (`startTurnTimer()`)

4. **`startVoteNewRound(initiatorId)`** (—Å—Ç—Ä–æ–∫–∞ 1560)
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `gameState = 'voting_new_round'`
   - –û—á–∏—â–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `voteInitiatorId = initiatorId`
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑:
     - `checkRoundEnd()` - –ø—Ä–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –ø–æ–±–µ–¥–µ (1 –∞–∫—Ç–∏–≤–Ω—ã–π –∏–≥—Ä–æ–∫)
     - `showdown()` - –ø–æ—Å–ª–µ –ø–æ–¥—Å—á–µ—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

5. **`getGameState()`** (—Å—Ç—Ä–æ–∫–∞ 2035)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã, –≤–∫–ª—é—á–∞—è:
     - `gameState: 'voting_new_round'`
     - `voteNewRoundPlayers: []`
     - `voteInitiatorId: null`
     - `readyToStartWithVoted: false` (–µ—Å–ª–∏ —Ç–∞–π–º–µ—Ä –ø—Ä–æ—à–µ–ª –∏ 3 –∏–∑ 4)

---

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏ "http not found":

### 1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL —Å–µ—Ä–≤–µ—Ä–∞**
- `getServerUrl()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
- –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3006
- CORS –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

### 2. **Endpoint –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω**
- `/api/vote-new-round` –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ Express
- Middleware `express.static('public')` –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã (–ù–ï –î–û–õ–ñ–ï–ù –±—ã—Ç—å –ø–µ—Ä–µ–¥ API routes)

### 3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–∞**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è GET –≤–º–µ—Å—Ç–æ POST
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ `Content-Type: application/json`

### 4. **–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞**
- `games.get(roomId)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `undefined`
- –ò–≥—Ä–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –ø–∞–º—è—Ç–∏

### 5. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**
- `roomId` –∏–ª–∏ `playerId` –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∏–ª–∏ –ø—É—Å—Ç—ã–µ

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3006
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ endpoint `/api/vote-new-round` –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `server.js`)
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `getServerUrl()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ - –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ URL –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ - –ø—Ä–∏—Ö–æ–¥–∏—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/vote-new-round`
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `roomId` –∏ `playerId` –Ω–µ `undefined` –≤ –∑–∞–ø—Ä–æ—Å–µ
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–≥—Ä–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `games.get(roomId)`
8. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `gameState === 'voting_new_round'` –∫–æ–≥–¥–∞ –≥–æ–ª–æ—Å—É—é—Ç

---

## üõ†Ô∏è –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å:

### –í –±—Ä–∞—É–∑–µ—Ä–µ (–∫–æ–Ω—Å–æ–ª—å F12):
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–æ–π URL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
getServerUrl() // –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 'http://localhost:3006'

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å roomId –∏ playerId
console.log('roomId:', roomId, 'playerId:', playerId)
```

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞):
- –ü—Ä–∏—Ö–æ–¥–∏—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å `POST /api/vote-new-round`?
- –ß—Ç–æ –≤ `req.body`?
- –ï—Å—Ç—å –ª–∏ –∏–≥—Ä–∞ –≤ `games.get(roomId)`?

### –í —Ñ–∞–π–ª–µ `server/server.js`:
- Endpoint –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–ü–ï–†–ï–î** `app.use(express.static('public'))`
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ `app.post('/api/vote-new-round', ...)`

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ–Ω —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 3006
2. –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ—á–Ω—É—é –æ—à–∏–±–∫—É
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network tab –≤ DevTools - –∫–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏ –∫–∞–∫–æ–π –æ—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ - –≤–∏–¥–∏—Ç –ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—Ä–æ—Å

